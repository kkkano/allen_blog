<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>决策树分裂实验室</title>
  <style>
    body { margin: 0; padding: 20px; background: #0b1120; color: #e5e7eb; font-family: "Segoe UI", "Microsoft YaHei", sans-serif; }
    .wrap { max-width: 900px; margin: 0 auto; background: #111827; border: 1px solid #1f2937; border-radius: 14px; padding: 18px; }
    h1 { font-size: 1.2rem; margin-bottom: 8px; color: #38bdf8; }
    p { color: #9ca3af; font-size: 0.9rem; line-height: 1.6; margin-bottom: 12px; }
    .grid { display: grid; grid-template-columns: 1.4fr 1fr; gap: 14px; }
    @media (max-width: 860px) { .grid { grid-template-columns: 1fr; } }
    canvas { width: 100%; border: 1px solid #374151; border-radius: 10px; background: #020617; }
    .panel { border: 1px solid #1f2937; border-radius: 10px; padding: 10px; background: #0f172a; }
    label { display: flex; justify-content: space-between; color: #94a3b8; font-size: 0.85rem; margin-bottom: 6px; }
    input[type='range'] { width: 100%; accent-color: #38bdf8; }
    .v { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; color: #fbbf24; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>分裂阈值与信息增益</h1>
    <p>拖动阈值，观察左右子节点纯度变化。你会看到“最佳分裂”本质上是让两边更纯。</p>
    <div class="grid">
      <canvas id="c" width="560" height="360"></canvas>
      <div class="panel">
        <label>分裂阈值 t <span id="tVal" class="v">0.00</span></label>
        <input id="thr" type="range" min="-2.5" max="2.5" step="0.05" value="0" />
        <label style="margin-top:10px">信息增益 IG <span id="igVal" class="v">0.000</span></label>
      </div>
    </div>
  </div>
  <script>
    const points = [];
    function randn(){let u=0,v=0;while(!u)u=Math.random();while(!v)v=Math.random();return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v)}
    for(let i=0;i<45;i++){points.push({x:randn()*0.8-1.0,y:1});points.push({x:randn()*0.8+1.0,y:0});}
    const c=document.getElementById('c'),ctx=c.getContext('2d');
    const thr=document.getElementById('thr'),tVal=document.getElementById('tVal'),igVal=document.getElementById('igVal');
    const sx=(x)=>30+((x+3)/6)*(c.width-60), sy=(y)=>y?120:250;
    const H=(p)=>{if(p<=0||p>=1) return 0; return -(p*Math.log2(p)+(1-p)*Math.log2(1-p));};
    function ig(th){
      const n=points.length;
      const left=points.filter(p=>p.x<=th), right=points.filter(p=>p.x>th);
      const p0=points.filter(p=>p.y===1).length/n;
      const pl=left.length?left.filter(p=>p.y===1).length/left.length:0;
      const pr=right.length?right.filter(p=>p.y===1).length/right.length:0;
      return H(p0)-(left.length/n)*H(pl)-(right.length/n)*H(pr);
    }
    function render(){
      const t=Number(thr.value); tVal.textContent=t.toFixed(2); igVal.textContent=ig(t).toFixed(3);
      ctx.clearRect(0,0,c.width,c.height);
      ctx.strokeStyle='rgba(148,163,184,.4)';ctx.beginPath();ctx.moveTo(30,310);ctx.lineTo(c.width-20,310);ctx.stroke();
      ctx.strokeStyle='#38bdf8';ctx.beginPath();ctx.moveTo(sx(t),30);ctx.lineTo(sx(t),310);ctx.stroke();
      for(const p of points){ctx.beginPath();ctx.arc(sx(p.x),sy(p.y)+ (Math.random()-0.5)*8,3.6,0,Math.PI*2);ctx.fillStyle=p.y?'#22c55e':'#ef4444';ctx.fill();}
      reportHeight();
    }
    function reportHeight(){const b=document.body,d=document.documentElement,c=document.querySelector('.w,.wrap,.container,.panel,.card')||b,s=getComputedStyle(b),p=(parseFloat(s.paddingTop)||0)+(parseFloat(s.paddingBottom)||0),ch=Math.ceil((c.getBoundingClientRect?c.getBoundingClientRect().height:0)+p),bh=Math.max(b.scrollHeight,b.offsetHeight),dh=Math.max(d.scrollHeight,d.offsetHeight),vh=window.innerHeight||d.clientHeight||0,dc=Math.abs(dh-vh)<=24?0:dh,h=Math.max(ch,bh,dc);window.parent.postMessage({type:'iframe-height',height:h},'*')}
    thr.addEventListener('input',render); window.addEventListener('load',()=>{render(); const ro=new ResizeObserver(reportHeight); ro.observe(document.body); ro.observe(document.documentElement); setTimeout(reportHeight,120); setTimeout(reportHeight,300);});
  </script>
</body>
</html>
