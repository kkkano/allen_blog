<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¢¯åº¦ä¸‹é™ - æˆæœ¬å‡½æ•°æ›²é¢</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: linear-gradient(135deg, #0f0c29 0%, #1a1a3e 50%, #24243e 100%);
    color: #e0e0e0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
  }
  .container {
    max-width: 900px;
    width: 100%;
    background: rgba(30, 30, 60, 0.85);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    border: 1px solid rgba(100,100,255,0.15);
  }
  h2 {
    text-align: center;
    font-size: 1.5em;
    background: linear-gradient(90deg, #f87171, #fbbf24);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 8px;
  }
  .subtitle {
    text-align: center;
    color: #94a3b8;
    font-size: 0.9em;
    margin-bottom: 20px;
  }
  .canvas-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }
  .canvas-box {
    text-align: center;
  }
  .canvas-box h3 {
    font-size: 0.95em;
    color: #c4b5fd;
    margin-bottom: 8px;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: rgba(15, 15, 35, 0.6);
    border-radius: 12px;
    border: 1px solid rgba(100,100,255,0.1);
  }
  .controls {
    display: flex;
    gap: 16px;
    justify-content: center;
    margin-top: 20px;
    flex-wrap: wrap;
  }
  .slider-group {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .slider-group label { font-size: 0.8em; color: #94a3b8; }
  .slider-group .value { font-size: 1em; font-weight: bold; color: #fbbf24; font-family: monospace; }
  input[type="range"] { width: 160px; accent-color: #818cf8; cursor: pointer; }
  .btn-row { display: flex; gap: 10px; justify-content: center; margin-top: 16px; }
  button {
    padding: 10px 24px; border: none; border-radius: 10px;
    font-size: 0.9em; font-weight: 600; cursor: pointer; transition: all 0.3s;
  }
  .btn-primary {
    background: linear-gradient(135deg, #f87171, #fbbf24); color: #1a1a2e;
  }
  .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(248,113,113,0.4); }
  .btn-secondary {
    background: rgba(60,60,100,0.8); color: #c4b5fd;
    border: 1px solid rgba(100,100,255,0.2);
  }
  .info-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-top: 16px;
  }
  .info-card {
    background: rgba(40,40,80,0.6);
    border-radius: 10px;
    padding: 10px;
    text-align: center;
    border: 1px solid rgba(100,100,255,0.1);
  }
  .info-card .label { font-size: 0.7em; color: #94a3b8; }
  .info-card .val { font-size: 1.1em; font-weight: bold; font-family: monospace; }
  .c1 { color: #f87171; }
  .c2 { color: #60a5fa; }
  .c3 { color: #a78bfa; }
  .c4 { color: #34d399; }
  .legend {
    text-align: center;
    margin-top: 12px;
    font-size: 0.82em;
    color: #94a3b8;
  }
</style>
</head>
<body>
<div class="container">
  <h2>ğŸ“‰ æ¢¯åº¦ä¸‹é™ï¼šæˆæœ¬å‡½æ•°çš„"ä¸‹å±±"ä¹‹æ—…</h2>
  <p class="subtitle">å·¦å›¾ï¼šç­‰é«˜çº¿ä¸Šçš„ä¸‹é™è·¯å¾„ | å³å›¾ï¼šæˆæœ¬éšè¿­ä»£æ¬¡æ•°çš„å˜åŒ–æ›²çº¿</p>

  <div class="canvas-row">
    <div class="canvas-box">
      <h3>J(w,b) ç­‰é«˜çº¿å›¾</h3>
      <canvas id="contour" width="400" height="380"></canvas>
    </div>
    <div class="canvas-box">
      <h3>æˆæœ¬ä¸‹é™æ›²çº¿</h3>
      <canvas id="curve" width="400" height="380"></canvas>
    </div>
  </div>

  <div class="controls">
    <div class="slider-group">
      <label>å­¦ä¹ ç‡ Î±</label>
      <div class="value" id="alphaVal">0.01</div>
      <input type="range" id="alphaSlider" min="0.001" max="0.05" step="0.001" value="0.01">
    </div>
    <div class="slider-group">
      <label>è¿­ä»£æ¬¡æ•°</label>
      <div class="value" id="iterVal">1500</div>
      <input type="range" id="iterSlider" min="100" max="3000" step="100" value="1500">
    </div>
  </div>

  <div class="btn-row">
    <button class="btn-primary" id="runBtn">â–¶ å¼€å§‹æ¢¯åº¦ä¸‹é™</button>
    <button class="btn-secondary" id="resetBtn">â†» é‡ç½®</button>
  </div>

  <div class="info-row">
    <div class="info-card"><div class="label">è¿­ä»£æ¬¡æ•°</div><div class="val c1" id="iVal">0</div></div>
    <div class="info-card"><div class="label">å½“å‰æˆæœ¬ J</div><div class="val c2" id="jVal">â€”</div></div>
    <div class="info-card"><div class="label">å½“å‰ w</div><div class="val c3" id="wVal">0.00</div></div>
    <div class="info-card"><div class="label">å½“å‰ b</div><div class="val c4" id="bvVal">0.00</div></div>
  </div>

  <div class="legend">
    ğŸ”´ çº¢è‰²è½¨è¿¹ = å‚æ•°æœç´¢è·¯å¾„ &nbsp;|&nbsp; â­ é»„è‰²æ˜Ÿæ˜Ÿ = å…¨å±€æœ€ä¼˜ç‚¹ &nbsp;|&nbsp; ç­‰é«˜çº¿é¢œè‰² = æˆæœ¬é«˜ä½
  </div>
</div>

<script>
const dataX = [6.1101,5.5277,8.5186,7.0032,5.8598,8.3829,7.4764,8.5781,6.4862,5.0546,
  5.7107,14.164,5.734,8.4084,5.6407,5.3794,6.3654,5.1301,6.4296,7.0708,
  6.1891,20.27,5.4901,6.3261,5.186,18.945,12.828,10.957,13.176,22.203,
  5.2524,6.5894,9.2482,5.8918,8.2111,7.9334,6.5736,7.5883,5.0269,11.711,
  5.0055,8.768,7.5422,5.0039,8.0106,7.1642,5.8428,7.4666,6.749,7.6543,
  9.3102,7.4086,7.4618,7.328,6.3711,6.2614,5.6484,6.7539,8.4757,6.0269,
  8.0727,7.2098,5.8727,5.6847,7.2854,8.7517,5.2149,6.7299,5.2074,6.2175,
  6.7172,7.0305,12.5,5.5894,6.7917,7.2448,6.1099,8.6282,7.7655,6.7676,
  8.5388,7.6969,6.5479,5.577,5.8048,6.9508,5.0737,8.9297,6.3328,5.8014,
  6.889,5.4528,5.6889,5.0556,6.1215,5.1884,5.1834];

const dataY = [17.592,9.1302,13.662,11.854,6.8233,11.886,4.3483,12.0,6.5987,3.8166,
  3.2522,15.505,3.1551,7.2258,0.7162,3.5129,5.3048,0.5609,3.6518,5.3893,
  3.1386,21.767,4.263,5.1875,3.0825,22.638,13.501,7.0467,14.692,24.147,
  -1.22,5.9966,12.134,1.8495,6.5426,4.5623,4.1164,7.2029,1.9869,0.14454,
  1.8495,12.0,2.6928,1.7152,6.5426,4.5623,1.9243,4.7143,3.9223,4.4284,
  14.573,5.8428,4.7143,6.7901,3.9624,5.3854,0.1657,4.3214,11.191,2.3218,
  6.5426,3.2522,4.3483,1.6118,4.7143,13.662,2.6397,5.4726,2.6397,3.2522,
  3.2522,3.5316,10.091,2.0962,5.4726,4.7143,3.5316,6.5426,4.7143,4.3483,
  10.091,4.7143,3.9624,2.6397,2.0962,3.5316,0.7162,10.091,3.9624,2.0962,
  5.4726,0.7162,2.0962,1.5841,3.2522,1.5841,1.6118];
const mm = dataX.length;

function cost(w, b) {
  let s = 0;
  for (let i = 0; i < mm; i++) { const d = w*dataX[i]+b-dataY[i]; s += d*d; }
  return s / (2*mm);
}
function grad(w, b) {
  let dw = 0, db = 0;
  for (let i = 0; i < mm; i++) { const d = w*dataX[i]+b-dataY[i]; dw += d*dataX[i]; db += d; }
  return [dw/mm, db/mm];
}

// Optimal values (pre-computed)
const optW = 1.166362, optB = -3.63029;

// Contour canvas
const cc = document.getElementById('contour');
const cctx = cc.getContext('2d');
// Curve canvas
const cv = document.getElementById('curve');
const cvctx = cv.getContext('2d');

const wRange = [-1, 4], bRange = [-15, 10];
const pad = { left: 50, right: 20, top: 20, bottom: 40 };

function toContourX(w) { return pad.left + (w - wRange[0]) / (wRange[1] - wRange[0]) * (cc.width - pad.left - pad.right); }
function toContourY(b) { return pad.top + (1 - (b - bRange[0]) / (bRange[1] - bRange[0])) * (cc.height - pad.top - pad.bottom); }

let costHistory = [];
let path = [];
let animating = false;
let animId = null;

function drawContour() {
  cctx.clearRect(0, 0, cc.width, cc.height);

  // Draw contour using computed cost
  const res = 80;
  const cw = (cc.width - pad.left - pad.right) / res;
  const ch = (cc.height - pad.top - pad.bottom) / res;

  for (let i = 0; i < res; i++) {
    for (let j = 0; j < res; j++) {
      const wv = wRange[0] + (i + 0.5) / res * (wRange[1] - wRange[0]);
      const bv = bRange[0] + (j + 0.5) / res * (bRange[1] - bRange[0]);
      const c = cost(wv, bv);
      const logC = Math.log(c + 1);
      const maxLogC = Math.log(300);
      const t = Math.min(logC / maxLogC, 1);

      const r = Math.floor(15 + t * 80);
      const g = Math.floor(15 + (1-t) * 40);
      const bl = Math.floor(35 + (1-t) * 120);
      cctx.fillStyle = `rgb(${r},${g},${bl})`;
      cctx.fillRect(pad.left + i * cw, pad.top + (res - 1 - j) * ch, cw + 1, ch + 1);
    }
  }

  // Contour lines
  const levels = [2, 4, 6, 10, 20, 40, 80, 150];
  cctx.strokeStyle = 'rgba(200,200,255,0.2)';
  cctx.lineWidth = 0.8;
  const cRes = 200;
  for (const level of levels) {
    for (let i = 0; i < cRes; i++) {
      const wv = wRange[0] + i / cRes * (wRange[1] - wRange[0]);
      for (let j = 0; j < cRes; j++) {
        const bv = bRange[0] + j / cRes * (bRange[1] - bRange[0]);
        const c = cost(wv, bv);
        if (Math.abs(c - level) < 0.8) {
          cctx.fillStyle = 'rgba(200,200,255,0.15)';
          cctx.fillRect(toContourX(wv), toContourY(bv), 2, 2);
        }
      }
    }
  }

  // Axes labels
  cctx.fillStyle = '#94a3b8';
  cctx.font = '11px system-ui';
  cctx.textAlign = 'center';
  for (let w = 0; w <= 3; w++) {
    cctx.fillText(w.toString(), toContourX(w), cc.height - pad.bottom + 18);
  }
  cctx.fillStyle = '#60a5fa';
  cctx.fillText('w', cc.width / 2, cc.height - 5);
  cctx.fillStyle = '#94a3b8';
  cctx.textAlign = 'right';
  for (let b = -10; b <= 5; b += 5) {
    cctx.fillText(b.toString(), pad.left - 8, toContourY(b) + 4);
  }
  cctx.save();
  cctx.translate(12, cc.height / 2);
  cctx.rotate(-Math.PI/2);
  cctx.fillStyle = '#a78bfa';
  cctx.textAlign = 'center';
  cctx.fillText('b', 0, 0);
  cctx.restore();

  // Optimal star
  cctx.fillStyle = '#fbbf24';
  cctx.shadowColor = '#fbbf24';
  cctx.shadowBlur = 15;
  const sx = toContourX(optW), sy = toContourY(optB);
  drawStar(cctx, sx, sy, 8, 5);
  cctx.shadowBlur = 0;

  // Path
  if (path.length > 1) {
    cctx.strokeStyle = '#f87171';
    cctx.lineWidth = 2;
    cctx.shadowColor = '#f87171';
    cctx.shadowBlur = 6;
    cctx.beginPath();
    cctx.moveTo(toContourX(path[0][0]), toContourY(path[0][1]));
    for (let i = 1; i < path.length; i++) {
      cctx.lineTo(toContourX(path[i][0]), toContourY(path[i][1]));
    }
    cctx.stroke();
    cctx.shadowBlur = 0;

    // Current point
    const last = path[path.length - 1];
    cctx.fillStyle = '#f87171';
    cctx.beginPath();
    cctx.arc(toContourX(last[0]), toContourY(last[1]), 5, 0, Math.PI*2);
    cctx.fill();
  }

  // Start point
  if (path.length > 0) {
    cctx.fillStyle = '#34d399';
    cctx.beginPath();
    cctx.arc(toContourX(path[0][0]), toContourY(path[0][1]), 5, 0, Math.PI*2);
    cctx.fill();
  }
}

function drawStar(ctx, cx, cy, r, points) {
  ctx.beginPath();
  for (let i = 0; i < points * 2; i++) {
    const angle = (i * Math.PI) / points - Math.PI / 2;
    const rad = i % 2 === 0 ? r : r * 0.4;
    const x = cx + Math.cos(angle) * rad;
    const y = cy + Math.sin(angle) * rad;
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  }
  ctx.closePath();
  ctx.fill();
}

function drawCurve() {
  cvctx.clearRect(0, 0, cv.width, cv.height);
  if (costHistory.length < 2) {
    cvctx.fillStyle = '#64748b';
    cvctx.font = '14px system-ui';
    cvctx.textAlign = 'center';
    cvctx.fillText('ç‚¹å‡»"å¼€å§‹æ¢¯åº¦ä¸‹é™"æŸ¥çœ‹æˆæœ¬æ›²çº¿', cv.width/2, cv.height/2);
    return;
  }

  const cPad = { left: 60, right: 20, top: 20, bottom: 40 };
  const pw = cv.width - cPad.left - cPad.right;
  const ph = cv.height - cPad.top - cPad.bottom;

  const maxJ = costHistory[0];
  const minJ = Math.min(...costHistory);
  const maxI = costHistory.length;

  function toCX(i) { return cPad.left + (i / maxI) * pw; }
  function toCY(j) { return cPad.top + (1 - (j - minJ) / (maxJ - minJ + 0.01)) * ph; }

  // Grid
  cvctx.strokeStyle = 'rgba(100,100,200,0.1)';
  cvctx.lineWidth = 1;
  for (let k = 0; k <= 4; k++) {
    const y = cPad.top + k * ph / 4;
    cvctx.beginPath(); cvctx.moveTo(cPad.left, y); cvctx.lineTo(cv.width - cPad.right, y); cvctx.stroke();
  }

  // Curve
  const gradient = cvctx.createLinearGradient(cPad.left, 0, cv.width - cPad.right, 0);
  gradient.addColorStop(0, '#f87171');
  gradient.addColorStop(0.5, '#fbbf24');
  gradient.addColorStop(1, '#34d399');
  cvctx.strokeStyle = gradient;
  cvctx.lineWidth = 2.5;
  cvctx.beginPath();
  for (let i = 0; i < costHistory.length; i++) {
    const x = toCX(i), y = toCY(costHistory[i]);
    i === 0 ? cvctx.moveTo(x, y) : cvctx.lineTo(x, y);
  }
  cvctx.stroke();

  // Fill area
  cvctx.lineTo(toCX(costHistory.length - 1), cPad.top + ph);
  cvctx.lineTo(toCX(0), cPad.top + ph);
  cvctx.closePath();
  const fillGrad = cvctx.createLinearGradient(0, cPad.top, 0, cPad.top + ph);
  fillGrad.addColorStop(0, 'rgba(248,113,113,0.15)');
  fillGrad.addColorStop(1, 'rgba(52,211,153,0.02)');
  cvctx.fillStyle = fillGrad;
  cvctx.fill();

  // Axes
  cvctx.fillStyle = '#94a3b8';
  cvctx.font = '11px system-ui';
  cvctx.textAlign = 'center';
  cvctx.fillText('0', toCX(0), cv.height - cPad.bottom + 18);
  cvctx.fillText(maxI.toString(), toCX(maxI), cv.height - cPad.bottom + 18);
  cvctx.fillStyle = '#fbbf24';
  cvctx.fillText('è¿­ä»£æ¬¡æ•°', cv.width / 2, cv.height - 5);

  cvctx.fillStyle = '#94a3b8';
  cvctx.textAlign = 'right';
  cvctx.fillText(maxJ.toFixed(1), cPad.left - 8, toCY(maxJ) + 4);
  cvctx.fillText(minJ.toFixed(1), cPad.left - 8, toCY(minJ) + 4);
  cvctx.save();
  cvctx.translate(12, cv.height/2);
  cvctx.rotate(-Math.PI/2);
  cvctx.fillStyle = '#f87171';
  cvctx.textAlign = 'center';
  cvctx.fillText('J(w,b)', 0, 0);
  cvctx.restore();
}

const alphaSlider = document.getElementById('alphaSlider');
const iterSlider = document.getElementById('iterSlider');
const runBtn = document.getElementById('runBtn');
const resetBtn = document.getElementById('resetBtn');

alphaSlider.addEventListener('input', () => {
  document.getElementById('alphaVal').textContent = parseFloat(alphaSlider.value).toFixed(3);
});
iterSlider.addEventListener('input', () => {
  document.getElementById('iterVal').textContent = iterSlider.value;
});

runBtn.addEventListener('click', () => {
  if (animating) return;
  animating = true;
  runBtn.textContent = 'â³ ä¸‹é™ä¸­...';
  runBtn.disabled = true;

  let w = 0, b = 0;
  const alpha = parseFloat(alphaSlider.value);
  const maxIter = parseInt(iterSlider.value);
  let iter = 0;
  path = [[w, b]];
  costHistory = [cost(w, b)];
  const stepsPerFrame = Math.max(1, Math.floor(maxIter / 300));

  function step() {
    for (let s = 0; s < stepsPerFrame; s++) {
      if (iter >= maxIter) break;
      const [dw, db] = grad(w, b);
      w -= alpha * dw;
      b -= alpha * db;
      iter++;
      if (iter % Math.max(1, Math.floor(maxIter / 200)) === 0) {
        path.push([w, b]);
        costHistory.push(cost(w, b));
      }
    }

    document.getElementById('iVal').textContent = iter;
    document.getElementById('jVal').textContent = cost(w, b).toFixed(4);
    document.getElementById('wVal').textContent = w.toFixed(4);
    document.getElementById('bvVal').textContent = b.toFixed(4);

    drawContour();
    drawCurve();

    if (iter < maxIter) {
      animId = requestAnimationFrame(step);
    } else {
      animating = false;
      runBtn.textContent = 'â–¶ å¼€å§‹æ¢¯åº¦ä¸‹é™';
      runBtn.disabled = false;
    }
  }
  step();
});

resetBtn.addEventListener('click', () => {
  if (animId) cancelAnimationFrame(animId);
  animating = false;
  runBtn.textContent = 'â–¶ å¼€å§‹æ¢¯åº¦ä¸‹é™';
  runBtn.disabled = false;
  path = [];
  costHistory = [];
  document.getElementById('iVal').textContent = '0';
  document.getElementById('jVal').textContent = 'â€”';
  document.getElementById('wVal').textContent = '0.00';
  document.getElementById('bvVal').textContent = '0.00';
  drawContour();
  drawCurve();
});

drawContour();
drawCurve();
</script>
</body>
</html>
