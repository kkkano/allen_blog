<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Softmaxæ¦‚ç‡åˆ†å¸ƒå¯è§†åŒ–</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1d4ed8 0%, #0f766e 100%);
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #1d4ed8;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1d4ed8;
            cursor: pointer;
        }
        .value-display {
            display: inline-block;
            background: #1d4ed8;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
        }
        .logits-inputs {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        .logit-input {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .logit-input input {
            width: 80%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .formula {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-family: 'Courier New', monospace;
            border: 2px solid #1d4ed8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Softmaxæ¦‚ç‡åˆ†å¸ƒå¯è§†åŒ–</h1>
        <p class="subtitle">æ¢ç´¢æ¸©åº¦å‚æ•°å¦‚ä½•å½±å“å¤šåˆ†ç±»ç¥ç»ç½‘ç»œçš„è¾“å‡ºæ¦‚ç‡</p>

        <div class="formula">
            <strong>Softmaxå…¬å¼ï¼š</strong> P(y=j) = exp(z_j / T) / Î£ exp(z_k / T)
        </div>

        <div class="controls">
            <div class="control-group">
                <label>
                    æ¸©åº¦å‚æ•° (Temperature):
                    <span class="value-display" id="tempValue">1.0</span>
                </label>
                <input type="range" id="temperature" min="0.1" max="5" step="0.1" value="1.0">
                <small style="color: #666;">T < 1: å¢å¼ºè‡ªä¿¡åº¦ | T > 1: é™ä½è‡ªä¿¡åº¦</small>
            </div>

            <div class="control-group">
                <label>è°ƒæ•´Logitså€¼ï¼ˆ10ä¸ªç±»åˆ«çš„åŸå§‹è¾“å‡ºï¼‰ï¼š</label>
                <div class="logits-inputs" id="logitsInputs"></div>
            </div>
        </div>

        <div id="barChart"></div>
        <div id="pieChart"></div>

        <div class="info-box">
            <strong>ğŸ’¡ å…³é”®æ´å¯Ÿï¼š</strong>
            <ul>
                <li><strong>T = 1.0</strong>: æ ‡å‡†Softmaxï¼Œå¹³è¡¡çš„æ¦‚ç‡åˆ†å¸ƒ</li>
                <li><strong>T < 1.0</strong>: æ¦‚ç‡åˆ†å¸ƒæ›´å°–é”ï¼Œæ¨¡å‹æ›´"è‡ªä¿¡"ï¼ˆé€‚åˆæ¨ç†é˜¶æ®µï¼‰</li>
                <li><strong>T > 1.0</strong>: æ¦‚ç‡åˆ†å¸ƒæ›´å¹³æ»‘ï¼Œæ¨¡å‹æ›´"è°¨æ…"ï¼ˆé€‚åˆçŸ¥è¯†è’¸é¦ï¼‰</li>
                <li><strong>åº”ç”¨åœºæ™¯</strong>: æ¸©åº¦ç¼©æ”¾å¸¸ç”¨äºæ¨¡å‹æ ¡å‡†å’Œé›†æˆå­¦ä¹ </li>
            </ul>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–10ä¸ªç±»åˆ«çš„logitsè¾“å…¥æ¡†
        const logitsContainer = document.getElementById('logitsInputs');
        const defaultLogits = [2.5, 1.8, 0.5, -0.3, 1.2, 0.8, -0.5, 1.5, 0.2, -0.8];

        for (let i = 0; i < 10; i++) {
            const div = document.createElement('div');
            div.className = 'logit-input';
            div.innerHTML = `
                <label>ç±»åˆ«${i}</label>
                <input type="number" id="logit${i}" value="${defaultLogits[i]}" step="0.1">
            `;
            logitsContainer.appendChild(div);
        }

        function softmax(logits, temperature) {
            const scaledLogits = logits.map(z => z / temperature);
            const maxLogit = Math.max(...scaledLogits);
            const exps = scaledLogits.map(z => Math.exp(z - maxLogit)); // æ•°å€¼ç¨³å®šæ€§æŠ€å·§
            const sumExps = exps.reduce((a, b) => a + b, 0);
            return exps.map(e => e / sumExps);
        }

        function build2DLayout(layout) {
            const axisBase = {
                gridcolor: '#dbe6f8',
                zerolinecolor: '#c5d6f3',
                linecolor: '#8ea9de',
                tickcolor: '#8ea9de',
                ticks: 'outside',
                automargin: true,
            };

            return {
                paper_bgcolor: '#f8fbff',
                plot_bgcolor: '#f8fbff',
                font: { color: '#0f172a' },
                margin: { t: 56, r: 24, b: 52, l: 60 },
                ...layout,
                xaxis: {
                    ...axisBase,
                    ...(layout?.xaxis || {}),
                },
                yaxis: {
                    ...axisBase,
                    ...(layout?.yaxis || {}),
                },
            };
        }


        function updateCharts() {
            const temperature = parseFloat(document.getElementById('temperature').value);
            document.getElementById('tempValue').textContent = temperature.toFixed(1);

            const logits = [];
            for (let i = 0; i < 10; i++) {
                logits.push(parseFloat(document.getElementById(`logit${i}`).value));
            }

            const probs = softmax(logits, temperature);
            const categories = Array.from({length: 10}, (_, i) => `ç±»åˆ«${i}`);

            // æŸ±çŠ¶å›¾
            const barTrace = {
                x: categories,
                y: probs,
                type: 'bar',
                marker: {
                    color: probs,
                    colorscale: 'YlGnBu',
                    showscale: true,
                    colorbar: {title: 'æ¦‚ç‡'}
                },
                text: probs.map(p => (p * 100).toFixed(1) + '%'),
                textposition: 'outside'
            };

            const barLayout = {
                title: `Softmaxæ¦‚ç‡åˆ†å¸ƒ (T=${temperature.toFixed(1)})`,
                xaxis: {title: 'ç±»åˆ«'},
                yaxis: {title: 'æ¦‚ç‡', range: [0, 1]},
                height: 400
            };

            Plotly.newPlot('barChart', [barTrace], build2DLayout(barLayout));

            // é¥¼å›¾
            const pieTrace = {
                labels: categories,
                values: probs,
                type: 'pie',
                textinfo: 'label+percent',
                marker: {
                    colors: ['#1d4ed8', '#0284c7', '#0f766e', '#0d9488',
                             '#14b8a6', '#22c55e', '#84cc16', '#eab308',
                             '#f59e0b', '#f97316']
                }
            };

            const pieLayout = {
                title: 'æ¦‚ç‡åˆ†å¸ƒé¥¼å›¾',
                height: 400
            };

            Plotly.newPlot('pieChart', [pieTrace], build2DLayout(pieLayout));
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('temperature').addEventListener('input', updateCharts);
        for (let i = 0; i < 10; i++) {
            document.getElementById(`logit${i}`).addEventListener('input', updateCharts);
        }

        // åˆå§‹åŒ–
        updateCharts();
    </script>

<script>
(function () {
  const sendHeight = () => {
    if (window.parent === window) return;
    const body = document.body;
    const root = document.documentElement;
    const height = Math.max(
      body ? body.scrollHeight : 0,
      body ? body.offsetHeight : 0,
      root ? root.scrollHeight : 0,
      root ? root.offsetHeight : 0
    );
    window.parent.postMessage({ type: 'iframe-height', height }, '*');
  };

  window.addEventListener('load', sendHeight);
  window.addEventListener('resize', sendHeight);

  if ('ResizeObserver' in window) {
    const observer = new ResizeObserver(sendHeight);
    if (document.body) observer.observe(document.body);
    if (document.documentElement) observer.observe(document.documentElement);
  }

  requestAnimationFrame(sendHeight);
  setTimeout(sendHeight, 250);
  setTimeout(sendHeight, 1000);
})();
</script>
</body>
</html>