<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šåˆ†ç±»å†³ç­–è¾¹ç•Œ3Då¯è§†åŒ–</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1d4ed8 0%, #0f766e 100%);
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #1d4ed8;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #1d4ed8;
            border-radius: 5px;
            font-size: 14px;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .legend {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ å¤šåˆ†ç±»å†³ç­–è¾¹ç•Œ3Då¯è§†åŒ–</h1>
        <p class="subtitle">é€šè¿‡PCAé™ç»´å±•ç¤º10ç±»æ‰‹å†™æ•°å­—åœ¨ç‰¹å¾ç©ºé—´ä¸­çš„åˆ†å¸ƒ</p>

        <div class="controls">
            <div class="control-group">
                <label>é€‰æ‹©å¯è§†åŒ–æ¨¡å¼ï¼š</label>
                <select id="viewMode" onchange="updateVisualization()">
                    <option value="3d">3Dæ•£ç‚¹å›¾ï¼ˆPCAå‰3ä¸ªä¸»æˆåˆ†ï¼‰</option>
                    <option value="2d">2DæŠ•å½±ï¼ˆPCAå‰2ä¸ªä¸»æˆåˆ†ï¼‰</option>
                    <option value="confusion">æ˜“æ··æ·†ç±»åˆ«å¯¹åˆ†æ</option>
                </select>
            </div>
            <div class="control-group">
                <label>é«˜äº®ç±»åˆ«ï¼š</label>
                <select id="highlightClass" onchange="updateVisualization()">
                    <option value="all">å…¨éƒ¨ç±»åˆ«</option>
                    <option value="0">æ•°å­— 0</option>
                    <option value="1">æ•°å­— 1</option>
                    <option value="2">æ•°å­— 2</option>
                    <option value="3">æ•°å­— 3</option>
                    <option value="4">æ•°å­— 4</option>
                    <option value="5">æ•°å­— 5</option>
                    <option value="6">æ•°å­— 6</option>
                    <option value="7">æ•°å­— 7</option>
                    <option value="8">æ•°å­— 8</option>
                    <option value="9">æ•°å­— 9</option>
                </select>
            </div>
        </div>

        <div id="mainChart"></div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #1d4ed8;"></div>
                <span>æ•°å­— 0</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #0284c7;"></div>
                <span>æ•°å­— 1</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #0f766e;"></div>
                <span>æ•°å­— 2</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #16a34a;"></div>
                <span>æ•°å­— 3</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #84cc16;"></div>
                <span>æ•°å­— 4</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #eab308;"></div>
                <span>æ•°å­— 5</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f59e0b;"></div>
                <span>æ•°å­— 6</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f97316;"></div>
                <span>æ•°å­— 7</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #dc2626;"></div>
                <span>æ•°å­— 8</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #475569;"></div>
                <span>æ•°å­— 9</span>
            </div>
        </div>

        <div class="info-box">
            <strong>ğŸ” å…³é”®æ´å¯Ÿï¼š</strong>
            <ul>
                <li><strong>PCAé™ç»´</strong>: å°†400ç»´åƒç´ ç©ºé—´é™è‡³3ç»´ï¼Œä¿ç•™ä¸»è¦å˜åŒ–æ–¹å‘</li>
                <li><strong>ç±»åˆ«åˆ†ç¦»åº¦</strong>: èšç±»è¶Šç´§å¯†ã€ç±»é—´è·ç¦»è¶Šå¤§ï¼Œåˆ†ç±»è¶Šå®¹æ˜“</li>
                <li><strong>æ˜“æ··æ·†å¯¹</strong>: å¦‚4å’Œ9ã€3å’Œ8åœ¨ç‰¹å¾ç©ºé—´ä¸­æœ‰é‡å åŒºåŸŸ</li>
                <li><strong>å†³ç­–è¾¹ç•Œ</strong>: ç¥ç»ç½‘ç»œå­¦ä¹ çš„æ˜¯é«˜ç»´ç©ºé—´ä¸­çš„éçº¿æ€§åˆ†ç•Œé¢</li>
                <li><strong>å®é™…åº”ç”¨</strong>: å¯ç”¨äºæ•°æ®è´¨é‡æ£€æŸ¥å’Œæ¨¡å‹è°ƒè¯•</li>
            </ul>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿç”ŸæˆPCAé™ç»´åçš„æ•°æ®ï¼ˆå®é™…åº”ç”¨ä¸­åº”ä½¿ç”¨çœŸå®æ•°æ®ï¼‰
        function generateMockData() {
            const data = [];
            const colors = ['#1d4ed8', '#0284c7', '#0f766e', '#16a34a', '#84cc16',
                           '#eab308', '#f59e0b', '#f97316', '#dc2626', '#475569'];

            for (let digit = 0; digit < 10; digit++) {
                const numSamples = 50;
                const centerX = Math.cos(digit * Math.PI / 5) * 5;
                const centerY = Math.sin(digit * Math.PI / 5) * 5;
                const centerZ = (digit % 3) * 3;

                for (let i = 0; i < numSamples; i++) {
                    data.push({
                        x: centerX + (Math.random() - 0.5) * 3,
                        y: centerY + (Math.random() - 0.5) * 3,
                        z: centerZ + (Math.random() - 0.5) * 2,
                        label: digit,
                        color: colors[digit]
                    });
                }
            }
            return data;
        }

        const mockData = generateMockData();

        function build2DLayout(layout) {
            const axisBase = {
                gridcolor: '#dbe6f8',
                zerolinecolor: '#c5d6f3',
                linecolor: '#8ea9de',
                tickcolor: '#8ea9de',
                ticks: 'outside',
                automargin: true,
            };

            return {
                paper_bgcolor: '#f8fbff',
                plot_bgcolor: '#f8fbff',
                font: { color: '#0f172a' },
                margin: { t: 56, r: 24, b: 52, l: 60 },
                ...layout,
                xaxis: {
                    ...axisBase,
                    ...(layout?.xaxis || {}),
                },
                yaxis: {
                    ...axisBase,
                    ...(layout?.yaxis || {}),
                },
            };
        }

        function build3DLayout(layout) {
            const sceneAxis = {
                showbackground: true,
                backgroundcolor: '#f8fbff',
                gridcolor: '#dbe6f8',
                zerolinecolor: '#c5d6f3',
                linecolor: '#8ea9de',
                tickcolor: '#8ea9de',
            };

            const currentScene = layout?.scene || {};

            return {
                paper_bgcolor: '#f8fbff',
                plot_bgcolor: '#f8fbff',
                font: { color: '#0f172a' },
                margin: { t: 56, r: 24, b: 30, l: 24 },
                ...layout,
                scene: {
                    bgcolor: '#f8fbff',
                    ...currentScene,
                    xaxis: {
                        ...sceneAxis,
                        ...(currentScene.xaxis || {}),
                    },
                    yaxis: {
                        ...sceneAxis,
                        ...(currentScene.yaxis || {}),
                    },
                    zaxis: {
                        ...sceneAxis,
                        ...(currentScene.zaxis || {}),
                    },
                },
            };
        }



        function updateVisualization() {
            const viewMode = document.getElementById('viewMode').value;
            const highlightClass = document.getElementById('highlightClass').value;

            let filteredData = mockData;
            if (highlightClass !== 'all') {
                const targetClass = parseInt(highlightClass);
                filteredData = mockData.map(d => ({
                    ...d,
                    color: d.label === targetClass ? d.color : '#cccccc',
                    opacity: d.label === targetClass ? 1.0 : 0.2
                }));
            }

            if (viewMode === '3d') {
                plot3DScatter(filteredData);
            } else if (viewMode === '2d') {
                plot2DProjection(filteredData);
            } else {
                plotConfusionPairs();
            }
        }

        function plot3DScatter(data) {
            const traces = [];
            for (let digit = 0; digit < 10; digit++) {
                const digitData = data.filter(d => d.label === digit);
                traces.push({
                    x: digitData.map(d => d.x),
                    y: digitData.map(d => d.y),
                    z: digitData.map(d => d.z),
                    mode: 'markers',
                    type: 'scatter3d',
                    name: `æ•°å­— ${digit}`,
                    marker: {
                        size: 5,
                        color: digitData[0].color,
                        opacity: digitData[0].opacity || 0.8
                    }
                });
            }

            const layout = {
                title: 'æ‰‹å†™æ•°å­—åœ¨PCAç©ºé—´ä¸­çš„3Dåˆ†å¸ƒ',
                scene: {
                    xaxis: {title: 'PC1 (ä¸»æˆåˆ†1)'},
                    yaxis: {title: 'PC2 (ä¸»æˆåˆ†2)'},
                    zaxis: {title: 'PC3 (ä¸»æˆåˆ†3)'}
                },
                height: 700,
                showlegend: false
            };

            Plotly.newPlot('mainChart', traces, build3DLayout(layout));
        }

        function plot2DProjection(data) {
            const traces = [];
            for (let digit = 0; digit < 10; digit++) {
                const digitData = data.filter(d => d.label === digit);
                traces.push({
                    x: digitData.map(d => d.x),
                    y: digitData.map(d => d.y),
                    mode: 'markers',
                    type: 'scatter',
                    name: `æ•°å­— ${digit}`,
                    marker: {
                        size: 8,
                        color: digitData[0].color,
                        opacity: digitData[0].opacity || 0.7
                    }
                });
            }

            const layout = {
                title: 'æ‰‹å†™æ•°å­—åœ¨PCAç©ºé—´ä¸­çš„2DæŠ•å½±',
                xaxis: {title: 'PC1 (ä¸»æˆåˆ†1)'},
                yaxis: {title: 'PC2 (ä¸»æˆåˆ†2)'},
                height: 600,
                showlegend: false
            };

            Plotly.newPlot('mainChart', traces, build2DLayout(layout));
        }

        function plotConfusionPairs() {
            // æ¨¡æ‹Ÿæ˜“æ··æ·†ç±»åˆ«å¯¹çš„æ•°æ®
            const confusionPairs = [
                {pair: '4 vs 9', count: 23, accuracy: 0.92},
                {pair: '3 vs 8', count: 18, accuracy: 0.94},
                {pair: '5 vs 6', count: 15, accuracy: 0.95},
                {pair: '7 vs 9', count: 12, accuracy: 0.96},
                {pair: '2 vs 7', count: 10, accuracy: 0.97},
                {pair: '1 vs 7', count: 8, accuracy: 0.98},
                {pair: '3 vs 5', count: 7, accuracy: 0.98},
                {pair: '0 vs 6', count: 5, accuracy: 0.99}
            ];

            const trace = {
                x: confusionPairs.map(p => p.pair),
                y: confusionPairs.map(p => p.count),
                type: 'bar',
                marker: {
                    color: confusionPairs.map(p => p.accuracy),
                    colorscale: 'RdYlGn',
                    showscale: true,
                    colorbar: {title: 'å‡†ç¡®ç‡'}
                },
                text: confusionPairs.map(p => `é”™è¯¯: ${p.count}<br>å‡†ç¡®ç‡: ${(p.accuracy*100).toFixed(1)}%`),
                hoverinfo: 'text'
            };

            const layout = {
                title: 'æ˜“æ··æ·†æ•°å­—å¯¹åˆ†æ',
                xaxis: {title: 'æ•°å­—å¯¹'},
                yaxis: {title: 'æ··æ·†æ¬¡æ•°'},
                height: 500
            };

            Plotly.newPlot('mainChart', [trace], build2DLayout(layout));
        }

        // åˆå§‹åŒ–
        updateVisualization();
    </script>

<script>
(function () {
  const sendHeight = () => {
    if (window.parent === window) return;
    const body = document.body;
    const root = document.documentElement;
    const height = Math.max(
      body ? body.scrollHeight : 0,
      body ? body.offsetHeight : 0,
      root ? root.scrollHeight : 0,
      root ? root.offsetHeight : 0
    );
    window.parent.postMessage({ type: 'iframe-height', height }, '*');
  };

  window.addEventListener('load', sendHeight);
  window.addEventListener('resize', sendHeight);

  if ('ResizeObserver' in window) {
    const observer = new ResizeObserver(sendHeight);
    if (document.body) observer.observe(document.body);
    if (document.documentElement) observer.observe(document.documentElement);
  }

  requestAnimationFrame(sendHeight);
  setTimeout(sendHeight, 250);
  setTimeout(sendHeight, 1000);
})();
</script>
</body>
</html>